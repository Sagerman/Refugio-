<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Espacio para Isa</title>
    <link rel="stylesheet" href="globals.css" />
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@400;600;700&display=swap');
      
      main {
        min-height: 90vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 20px;
      }

      /* Animaci√≥n de la Estrella */
      .animate-pulse-glow {
        font-size: 4rem;
        margin-bottom: 20px;
        display: inline-block;
        animation: soft-glow 2.5s ease-in-out infinite;
      }

      @keyframes soft-glow {
        0% { transform: scale(1); filter: drop-shadow(0 0 0 rgba(159, 122, 234, 0)); }
        50% { transform: scale(1.1); filter: drop-shadow(0 0 15px rgba(253, 224, 71, 0.6)); }
        100% { transform: scale(1); filter: drop-shadow(0 0 0 rgba(159, 122, 234, 0)); }
      }

      .outline-btn {
        background: transparent;
        border: 2px solid #b39ddb;
        color: #5e3375;
        padding: 12px 30px;
        border-radius: 50px;
        font-weight: 600;
        margin-top: 20px;
        cursor: pointer;
        transition: 0.3s;
      }
      .outline-btn:hover { background: #f3e5f5; transform: translateY(-2px); }
      
      .error-msg { color: crimson; font-size: 0.8rem; margin-top: 5px; display: none; }

      /* Navegaci√≥n */
      .nav-container {
        display: flex;
        justify-content: space-between;
        width: 100%;
        margin-top: 20px;
      }
      
      .nav-btn {
        background: transparent;
        border: none;
        color: #9f7aea;
        font-weight: 700;
        cursor: pointer;
        font-size: 0.9rem;
        padding: 10px;
        transition: 0.2s;
      }
      .nav-btn:hover { color: #5e3375; transform: scale(1.1); }
      .nav-btn:disabled { color: #e2e8f0; cursor: default; transform: none; }

    </style>
  </head>
  
  <body>
    <div class="background-blob blob-1"></div>
    <div class="background-blob blob-2"></div>

    <main>
      
      <section id="welcome-view" class="card fade-in" style="text-align: center;">
        <div class="animate-pulse-glow" style="color: #9f7aea;">üíú</div>

        <h1 id="welcome-title" style="font-size: 1.4rem; color: #5e3375; margin-bottom: 15px;">
          Hola, Isa
        </h1>
        
        <p id="welcome-text" class="message-text" style="font-size: 1.1rem; margin-bottom: 30px;">
          He preparado un lugar para ti.
        </p>
        
        <button class="welcome-btn" onclick="goToIntro()">Entrar un momento</button>
        
        <p style="font-size: 0.8rem; color: #888; margin-top: 15px; opacity: 0.7;">Usa aud√≠fonos üéß</p>
      </section>

      <section id="intro-view" class="card fade-in" hidden style="text-align: center;">
        <div class="animate-pulse-glow">üåü</div>
        
        <h2 style="font-size: 1.2rem; color: #5e3375; margin-bottom: 20px;">
          Tengo algo que decirte...
        </h2>
        
        <div class="audio-wrapper">
          <audio id="intro-audio" controls class="custom-audio" preload="auto" onerror="mostrarError(this)">
            <source src="audios/Introduccion.mp3" type="audio/mpeg">
            Tu navegador no soporta el audio.
          </audio>
          <p class="error-msg">‚ö†Ô∏è No encuentro 'audios/Introduccion.mp3'</p>
        </div>

        <p style="font-size: 0.9rem; margin: 20px 0; color: #666;">Dale play cuando est√©s lista ‚òùÔ∏è</p>
        
        <button class="outline-btn" onclick="goToMessages()">Continuar</button>
      </section>

      <section id="player-view" hidden>
        <div id="messageContainer"></div>
      </section>

    </main>

    <footer><p>Con cari√±o ‚ú®</p></footer>

    <script>
      /* --- TUS MENSAJES --- */
      const messages = [
        {
          id: 1, 
          title: 'D√≠a 1: Calma (Parte 1 y 2)',
          verse: '"Porque yo s√© los pensamientos que tengo acerca de vosotros..." - Jerem√≠as 29:11',
          message: 'Hoy iniciamos con algo importante. Te dej√© dos notas de voz. Escucha la primera y luego la segunda.',
          audio: ['audios/1.mp3', 'audios/1.2.mp3'], 
        },
        {
          id: 2,
          title: 'D√≠a 2: Cargas',
          /* TEXTO B√çBLICO COMPLETO */
          verse: '"Todo lo hizo hermoso en su tiempo; y ha puesto eternidad en el coraz√≥n de ellos, sin que alcance el hombre a entender la obra que ha hecho Dios desde el principio hasta el fin." - Eclesiast√©s 3:11',
          /* MENSAJE DE FORTALEZA (DIFERENTE AL GUI√ìN) */
          message: 'Aunque ahora no veas el cuadro completo, conf√≠a en que Dios est√° haciendo algo hermoso con tu vida. Su reloj no se atrasa ni se adelanta; √âl sabe exactamente lo que hace contigo. Mantente firme en medio del proceso.',
          audio: 'audios/2.mp3', 
        },
      ];

      /* CLAVE DE ALMACENAMIENTO */
      const STORAGE_KEY = 'isa_espacio_history_v1'; 

      /* --- L√ìGICA DE ESTADO --- */
      function getAppState() {
        const stored = localStorage.getItem(STORAGE_KEY);
        if (!stored) return { introPlayed: false, maxUnlockedIndex: 0, currentViewIndex: 0, lastVisitDate: null };
        return JSON.parse(stored);
      }

      function saveAppState(state) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
      }

      /* --- NAVEGACI√ìN --- */
      function goToIntro() {
        const state = getAppState();
        document.getElementById('welcome-view').hidden = true;

        if (!state.introPlayed) {
            document.getElementById('intro-view').hidden = false;
            document.getElementById('intro-view').classList.add('fade-in');
        } else {
            // Si ya vio intro, vamos directo a mensajes
            checkDailyProgress(state);
            showCurrentMessage(state);
            document.getElementById('player-view').hidden = false;
            document.getElementById('player-view').classList.add('fade-in');
        }
      }

      function goToMessages() {
        const state = getAppState();
        document.getElementById('intro-audio').pause();
        state.introPlayed = true;
        saveAppState(state);

        document.getElementById('intro-view').hidden = true;
        
        checkDailyProgress(state); 
        showCurrentMessage(state);
        
        document.getElementById('player-view').hidden = false;
        document.getElementById('player-view').classList.add('fade-in');
      }

      /* --- L√ìGICA DE D√çAS Y DESBLOQUEO --- */
      function checkDailyProgress(state) {
        const today = new Date().toDateString();
        
        // Si es un d√≠a diferente al √∫ltimo que entr√≥...
        if (state.lastVisitDate !== null && state.lastVisitDate !== today) {
            // Y no ha llegado al final de los mensajes...
            if (state.maxUnlockedIndex < messages.length - 1) {
                state.maxUnlockedIndex++; // DESBLOQUEA EL SIGUIENTE
            }
        }
        
        // Actualizamos fecha de √∫ltima visita
        state.lastVisitDate = today;
        
        // Por defecto, mostramos lo m√°s nuevo que tenga desbloqueado
        state.currentViewIndex = state.maxUnlockedIndex;
        
        saveAppState(state);
      }

      function changeMessage(direction) {
        const state = getAppState();
        const newIndex = state.currentViewIndex + direction;

        if (newIndex >= 0 && newIndex <= state.maxUnlockedIndex) {
            state.currentViewIndex = newIndex;
            saveAppState(state);
            
            const container = document.getElementById('messageContainer');
            container.style.opacity = 0;
            setTimeout(() => {
                showCurrentMessage(state);
                container.style.opacity = 1;
            }, 200);
        }
      }

      function showCurrentMessage(state) {
        const container = document.getElementById('messageContainer');
        const msg = messages[state.currentViewIndex];
        container.innerHTML = renderCard(msg, state);
      }

      /* --- RENDERIZADO --- */
      function renderCard(msg, state) {
        let audioHTML = '';
        if (Array.isArray(msg.audio)) {
            msg.audio.forEach((src, index) => {
                audioHTML += `
                <div class="audio-container">
                    <p class="audio-label">Parte ${index + 1}</p>
                    <div class="audio-wrapper">
                        <audio controls class="custom-audio" onerror="mostrarError(this)">
                            <source src="${src}" type="audio/mpeg">
                        </audio>
                        <p class="error-msg">‚ö†Ô∏è No encuentro '${src}'</p>
                    </div>
                </div>`;
            });
        } else {
            audioHTML = `
            <div class="audio-container">
                <div class="audio-wrapper">
                    <audio controls class="custom-audio" onerror="mostrarError(this)">
                        <source src="${msg.audio}" type="audio/mpeg">
                    </audio>
                    <p class="error-msg">‚ö†Ô∏è No encuentro '${msg.audio}'</p>
                </div>
            </div>`;
        }

        const hasPrev = state.currentViewIndex > 0;
        const hasNext = state.currentViewIndex < state.maxUnlockedIndex;

        return `
        <article class="card fade-in">
          <div class="card-title">${msg.title}</div>
          ${audioHTML}
          <div style="border-left: 3px solid #b39ddb; padding-left: 15px; margin: 20px 0;">
            <p class="verse-text">${msg.verse}</p>
          </div>
          <p class="message-text">${msg.message}</p>
          
          <div class="nav-container">
             <button class="nav-btn" onclick="changeMessage(-1)" ${!hasPrev ? 'disabled' : ''}>
                ${hasPrev ? '‚¨Ö Anterior' : ''}
             </button>
             
             <span style="font-size: 0.8rem; color: #aaa; align-self: center;">
                ${state.currentViewIndex + 1} / ${state.maxUnlockedIndex + 1}
             </span>

             <button class="nav-btn" onclick="changeMessage(1)" ${!hasNext ? 'disabled' : ''}>
                ${hasNext ? 'Siguiente ‚û°' : ''}
             </button>
          </div>
        </article>
        `;
      }

      function mostrarError(audio) {
         if(audio.parentElement.querySelector('.error-msg')) {
            audio.parentElement.querySelector('.error-msg').style.display = 'block';
         }
      }
      
      document.addEventListener('DOMContentLoaded', () => {
        const state = getAppState();
        if (state.introPlayed) {
           document.getElementById('welcome-title').innerText = "Hola de nuevo, Isa";
           document.getElementById('welcome-text').innerText = "Tu mensaje est√° listo.";
        }
      });
    </script>
  </body>
</html>