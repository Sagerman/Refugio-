<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Espacio para Isa</title>
    <link rel="stylesheet" href="globals.css" />
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@400;600;700&display=swap');
      
      main {
        min-height: 90vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 20px;
      }

      /* Animaci√≥n suave */
      .animate-pulse-glow {
        font-size: 4rem;
        margin-bottom: 20px;
        display: inline-block;
        animation: soft-glow 2.5s ease-in-out infinite;
      }

      @keyframes soft-glow {
        0% { transform: scale(1); filter: drop-shadow(0 0 0 rgba(159, 122, 234, 0)); }
        50% { transform: scale(1.1); filter: drop-shadow(0 0 15px rgba(253, 224, 71, 0.6)); }
        100% { transform: scale(1); filter: drop-shadow(0 0 0 rgba(159, 122, 234, 0)); }
      }

      .welcome-btn {
        background: linear-gradient(to right, #b39ddb, #9575cd); 
        color: white; border: none; padding: 16px 35px; border-radius: 50px;
        font-size: 1rem; font-weight: 600; width: 100%;
        box-shadow: 0 8px 20px rgba(149, 117, 205, 0.3);
        transition: all 0.3s ease;
        cursor: pointer;
      }
      .welcome-btn:hover {
        background: linear-gradient(to right, #9575cd, #7e57c2);
        transform: translateY(-3px);
      }
      
      .error-msg { color: crimson; font-size: 0.8rem; margin-top: 5px; display: none; }

      /* Navegaci√≥n */
      .nav-container {
        display: flex;
        justify-content: space-between;
        width: 100%;
        margin-top: 20px;
      }
      
      .nav-btn {
        background: transparent;
        border: none;
        color: #9f7aea;
        font-weight: 700;
        cursor: pointer;
        font-size: 0.9rem;
        padding: 10px;
        transition: 0.2s;
      }
      .nav-btn:hover { color: #5e3375; transform: scale(1.1); }
      .nav-btn:disabled { color: #e2e8f0; cursor: default; transform: none; }

    </style>
  </head>
  
  <body>
    <div class="background-blob blob-1"></div>
    <div class="background-blob blob-2"></div>

    <main>
      
      <section id="welcome-view" class="card fade-in" style="text-align: center;">
        <div class="animate-pulse-glow" style="color: #9f7aea;">üíú</div>

        <h1 id="welcome-title" style="font-size: 1.4rem; color: #5e3375; margin-bottom: 15px;">
          Hola, Isa
        </h1>
        
        <p id="welcome-text" class="message-text" style="font-size: 1.1rem; margin-bottom: 30px;">
          Aqu√≠ est√° tu mensaje de hoy.
        </p>
        
        <button class="welcome-btn" onclick="enterApp()">Ver mensaje</button>
        
        <p style="font-size: 0.8rem; color: #888; margin-top: 15px; opacity: 0.7;">Usa aud√≠fonos üéß</p>
      </section>

      <section id="player-view" hidden>
        <div id="messageContainer"></div>
      </section>

    </main>

    <footer><p>Con cari√±o ‚ú®</p></footer>

    <script>
      /* --- TUS MENSAJES --- */
      const messages = [
        {
          id: 1, 
          title: 'D√≠a 1: Calma (Parte 1 y 2)',
          verse: '"Porque yo s√© los pensamientos que tengo acerca de vosotros..." - Jerem√≠as 29:11',
          message: 'Hoy iniciamos con algo importante. Te dej√© dos notas de voz. Escucha la primera y luego la segunda.',
          audio: ['audios/1.mp3', 'audios/1.2.mp3'], 
        },
        {
          id: 2,
          title: 'D√≠a 2: Cargas',
          verse: '"Todo lo hizo hermoso en su tiempo; y ha puesto eternidad en el coraz√≥n de ellos, sin que alcance el hombre a entender la obra que ha hecho Dios desde el principio hasta el fin." - Eclesiast√©s 3:11',
          message: 'Aunque ahora no veas el cuadro completo, conf√≠a en que Dios est√° haciendo algo hermoso con tu vida. Su reloj no se atrasa ni se adelanta; √âl sabe exactamente lo que hace contigo. Mantente firme en medio del proceso.',
          audio: 'audios/2.mp3', 
        },
      ];

      /* CAMBI√â LA CLAVE PARA REINICIAR Y APLICAR CAMBIOS */
      const STORAGE_KEY = 'isa_espacio_unlocked_v1'; 

      /* --- CONFIGURACI√ìN INICIAL --- */
      function getAppState() {
        const stored = localStorage.getItem(STORAGE_KEY);
        // TRUCO: Aqu√≠ ponemos maxUnlockedIndex en 1 (que es el D√≠a 2)
        // As√≠, aunque sea nueva, ya tiene el D√≠a 2 habilitado.
        if (!stored) return { 
            maxUnlockedIndex: 1, // 0 = D√≠a 1, 1 = D√≠a 2 (DESBLOQUEADO POR DEFECTO)
            currentViewIndex: 1, // Empieza mostrando el D√≠a 2 directamente
            lastVisitDate: new Date().toDateString() 
        };
        return JSON.parse(stored);
      }

      function saveAppState(state) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
      }

      /* --- FUNCI√ìN DE ENTRADA DIRECTA --- */
      function enterApp() {
        const state = getAppState();
        
        // Ocultamos bienvenida
        const welcomeView = document.getElementById('welcome-view');
        welcomeView.style.display = 'none';

        // Revisamos si corresponde desbloquear m√°s d√≠as (por si volvemos en el D√≠a 3)
        checkDailyProgress(state);
        
        // Mostramos mensajes
        showCurrentMessage(state);
        const playerView = document.getElementById('player-view');
        playerView.hidden = false;
        playerView.classList.add('fade-in');
      }

      /* --- L√ìGICA DE PROGRESO --- */
      function checkDailyProgress(state) {
        const today = new Date().toDateString();
        
        if (state.lastVisitDate !== null && state.lastVisitDate !== today) {
            if (state.maxUnlockedIndex < messages.length - 1) {
                state.maxUnlockedIndex++; 
            }
        }
        state.lastVisitDate = today;
        
        // Si ya tiene desbloqueado el 2 (√≠ndice 1), nos aseguramos que vea ese
        // a menos que ella haya navegado manualmente antes.
        // Pero por seguridad, mostremos el m√°s reciente desbloqueado.
        state.currentViewIndex = state.maxUnlockedIndex;
        
        saveAppState(state);
      }

      function changeMessage(direction) {
        const state = getAppState();
        const newIndex = state.currentViewIndex + direction;

        if (newIndex >= 0 && newIndex <= state.maxUnlockedIndex) {
            state.currentViewIndex = newIndex;
            saveAppState(state);
            
            const container = document.getElementById('messageContainer');
            container.style.opacity = 0;
            setTimeout(() => {
                showCurrentMessage(state);
                container.style.opacity = 1;
            }, 200);
        }
      }

      function showCurrentMessage(state) {
        const container = document.getElementById('messageContainer');
        const msg = messages[state.currentViewIndex];
        container.innerHTML = renderCard(msg, state);
      }

      function renderCard(msg, state) {
        let audioHTML = '';
        if (Array.isArray(msg.audio)) {
            msg.audio.forEach((src, index) => {
                audioHTML += `
                <div class="audio-container">
                    <p class="audio-label">Parte ${index + 1}</p>
                    <div class="audio-wrapper">
                        <audio controls class="custom-audio" onerror="mostrarError(this)">
                            <source src="${src}" type="audio/mpeg">
                        </audio>
                        <p class="error-msg">‚ö†Ô∏è No encuentro '${src}'</p>
                    </div>
                </div>`;
            });
        } else {
            audioHTML = `
            <div class="audio-container">
                <div class="audio-wrapper">
                    <audio controls class="custom-audio" onerror="mostrarError(this)">
                        <source src="${msg.audio}" type="audio/mpeg">
                    </audio>
                    <p class="error-msg">‚ö†Ô∏è No encuentro '${msg.audio}'</p>
                </div>
            </div>`;
        }

        const hasPrev = state.currentViewIndex > 0;
        const hasNext = state.currentViewIndex < state.maxUnlockedIndex;

        return `
        <article class="card fade-in">
          <div class="card-title">${msg.title}</div>
          ${audioHTML}
          <div style="border-left: 3px solid #b39ddb; padding-left: 15px; margin: 20px 0;">
            <p class="verse-text">${msg.verse}</p>
          </div>
          <p class="message-text">${msg.message}</p>
          
          <div class="nav-container">
             <button class="nav-btn" onclick="changeMessage(-1)" ${!hasPrev ? 'disabled' : ''}>
                ${hasPrev ? '‚¨Ö Anterior' : ''}
             </button>
             
             <span style="font-size: 0.8rem; color: #aaa; align-self: center;">
                ${state.currentViewIndex + 1} / ${state.maxUnlockedIndex + 1}
             </span>

             <button class="nav-btn" onclick="changeMessage(1)" ${!hasNext ? 'disabled' : ''}>
                ${hasNext ? 'Siguiente ‚û°' : ''}
             </button>
          </div>
        </article>
        `;
      }

      function mostrarError(audio) {
         if(audio.parentElement.querySelector('.error-msg')) {
            audio.parentElement.querySelector('.error-msg').style.display = 'block';
         }
      }
    </script>
  </body>
</html>