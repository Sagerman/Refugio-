<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Espacio para Isa</title>
    <link rel="stylesheet" href="globals.css" />
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@400;600;700&display=swap');
      
      main {
        min-height: 90vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 20px;
      }

      .animate-pulse-glow {
        font-size: 4rem;
        margin-bottom: 20px;
        display: inline-block;
        animation: soft-glow 2.5s ease-in-out infinite;
      }

      @keyframes soft-glow {
        0% { transform: scale(1); filter: drop-shadow(0 0 0 rgba(159, 122, 234, 0)); }
        50% { transform: scale(1.1); filter: drop-shadow(0 0 15px rgba(253, 224, 71, 0.6)); }
        100% { transform: scale(1); filter: drop-shadow(0 0 0 rgba(159, 122, 234, 0)); }
      }

      .welcome-btn {
        background: linear-gradient(to right, #b39ddb, #9575cd); 
        color: white; border: none; padding: 16px 35px; border-radius: 50px;
        font-size: 1rem; font-weight: 600; width: 100%;
        box-shadow: 0 8px 20px rgba(149, 117, 205, 0.3);
        transition: all 0.3s ease;
        cursor: pointer;
      }
      .welcome-btn:hover {
        background: linear-gradient(to right, #9575cd, #7e57c2);
        transform: translateY(-3px);
      }
      
      .error-msg { color: crimson; font-size: 0.8rem; margin-top: 5px; display: none; }

      .nav-container {
        display: flex;
        justify-content: space-between;
        width: 100%;
        margin-top: 20px;
      }
      
      .nav-btn {
        background: transparent;
        border: none;
        color: #9f7aea;
        font-weight: 700;
        cursor: pointer;
        font-size: 0.9rem;
        padding: 10px;
        transition: 0.2s;
      }
      .nav-btn:hover { color: #5e3375; transform: scale(1.1); }
      .nav-btn:disabled { color: #e2e8f0; cursor: default; transform: none; }
      
      /* Estilos para el nuevo bot√≥n final */
      .final-action-container {
        margin-top: 30px;
        border-top: 1px dashed #e2e8f0;
        padding-top: 20px;
        text-align: center;
      }
      .whatsapp-btn {
        background-color: #4CAF50; /* Color verde WhatsApp */
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 50px;
        font-weight: 600;
        font-size: 1.05rem;
        width: 100%;
        max-width: 300px;
        margin-top: 15px;
        box-shadow: 0 4px 10px rgba(76, 175, 80, 0.4);
        transition: background-color 0.2s;
        text-decoration: none; /* Asegurar que no tenga subrayado */
        display: inline-block;
      }
      .whatsapp-btn:hover {
        background-color: #45a049;
        transform: translateY(-2px);
      }
    </style>
  </head>
  
  <body>
    <div class="background-blob blob-1"></div>
    <div class="background-blob blob-2"></div>

    <main>
      
      <section id="welcome-view" class="card fade-in" style="text-align: center;">
        <div class="animate-pulse-glow" style="color: #9f7aea;">üíú</div>

        <h1 id="welcome-title" style="font-size: 1.4rem; color: #5e3375; margin-bottom: 15px;">
          Hola, Isa
        </h1>
        
        <p id="welcome-text" class="message-text" style="font-size: 1.1rem; margin-bottom: 30px;">
          Aqu√≠ est√° tu mensaje final.
        </p>
        
        <button class="welcome-btn" onclick="enterApp()">Ver mensaje</button>
        
        <p style="font-size: 0.8rem; color: #888; margin-top: 15px; opacity: 0.7;">Usa aud√≠fonos üéß</p>
      </section>

      <section id="player-view" hidden>
        <div id="messageContainer"></div>
      </section>

    </main>

    <footer><p>Con cari√±o ‚ú®</p></footer>

    <script>
      /* --- CONFIGURACI√ìN DE WHATSAPP --- */
      const WHATSAPP_NUMBER = '573142101197'; 
      const MESSAGE_TEXT = encodeURIComponent('¬°S√≠! ¬°Quiero que me acompa√±es otra semana m√°s! ü´Ç');
      const WHATSAPP_URL = `https://wa.me/${WHATSAPP_NUMBER}?text=${MESSAGE_TEXT}`;

      /* --- LISTA DE MENSAJES (FINAL) --- */
      const messages = [
        {
          id: 1, 
          title: 'D√≠a 1: Calma (Parte 1 y 2)',
          verse: '"Porque yo s√© los pensamientos que tengo acerca de vosotros..." - Jerem√≠as 29:11',
          message: 'Hoy iniciamos con algo importante. Te dej√© dos notas de voz. Escucha la primera y luego la segunda.',
          audio: ['audios/1.mp3', 'audios/1.2.mp3'], 
        },
        {
          id: 2,
          title: 'D√≠a 2: Cargas',
          verse: '"Todo lo hizo hermoso en su tiempo; y ha puesto eternidad en el coraz√≥n de ellos..." - Eclesiast√©s 3:11',
          message: 'Aunque ahora no veas el cuadro completo, conf√≠a en que Dios est√° haciendo algo hermoso con tu vida. Su reloj no se atrasa ni se adelanta.',
          audio: 'audios/2.opus', 
        },
        {
          id: 3,
          title: 'D√≠a 3: El Abrazo',
          verse: '"Y cuando a√∫n estaba lejos, lo vio su padre... y corri√≥, y se ech√≥ sobre su cuello, y le bes√≥." - Lucas 15:20',
          message: 'A veces creemos que debemos estar "perfectos" para acercarnos a Dios. Pero √âl no espera a que te limpies; √âl corre a abrazarte tal como est√°s.',
          audio: 'audios/3.opus', 
        },
        {
          id: 4,
          title: 'D√≠a 4: La Sed Real',
          verse: '"Mas el que bebiere del agua que yo le dar√©, no tendr√° sed jam√°s." - Juan 4:14',
          message: 'El mundo ofrece muchas cosas para calmar nuestra sed, pero siempre volvemos a sentirnos vac√≠os. Solo hay una fuente que satisface el alma para siempre.',
          audio: 'audios/4.opus', 
        },
        {
          id: 5,
          title: 'D√≠a 5: Amor Eterno',
          verse: '"Con amor eterno te he amado; por tanto, te prolongu√© mi misericordia." - Jerem√≠as 31:3',
          message: 'Afuera, el amor suele tener condiciones. Pero el amor de Dios no depende de tus logros ni de tus errores. Es un regalo eterno que no se gasta.',
          audio: 'audios/5.opus', 
        },
        {
          id: 6,
          title: 'D√≠a 6: Tus L√°grimas',
          verse: '"T√∫ llevas la cuenta de todas mis angustias... has registrado cada una de mis l√°grimas en tu libro." - Salmos 56:8',
          message: 'No tienes que esconder tu tristeza. Dios no ignora tu dolor; √âl atesora cada l√°grima porque t√∫ eres valiosa para √âl.',
          audio: 'audios/6.opus', 
        },
        {
          id: 7,
          title: 'D√≠a 7: Obra Maestra',
          verse: '"Te alabar√©; porque formidables, maravillosas son tus obras." - Salmos 139:14',
          message: 'No necesitas copiar a nadie m√°s. El Artista que cre√≥ el universo te dise√±√≥ a ti con un prop√≥sito √∫nico. Eres una obra de arte original.',
          audio: 'audios/7.opus', 
        },
        /* --- D√çA 8: FINAL CON ARCHIVOS .OGA --- */
        {
          id: 8,
          title: 'D√≠a 8: La Puerta Siempre Abierta (Parte 1 y 2)',
          verse: '"He aqu√≠, yo estoy a la puerta y llamo; si alguno oye mi voz y abre la puerta, entrar√© a √©l." - Apocalipsis 3:20',
          message: 'Hoy cerramos esta serie de 8 d√≠as. Te dej√© dos notas de voz: una con el mensaje de cierre y otra con una propuesta especial para que la serie contin√∫e.',
          /* Aqu√≠ usamos tus archivos tal cual: 8.oga y 8.2.oga */
          audio: ['audios/8.oga', 'audios/8.2.oga'], 
        },
      ];

      /* CLAVE FINAL */
      const STORAGE_KEY = 'isa_espacio_final_oga_v2'; 

      function getAppState() {
        const stored = localStorage.getItem(STORAGE_KEY);
        if (!stored) return { 
            maxUnlockedIndex: 7, // D√çA 8 DESBLOQUEADO
            currentViewIndex: 7, 
            lastVisitDate: new Date().toDateString() 
        };
        return JSON.parse(stored);
      }

      function saveAppState(state) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
      }

      function enterApp() {
        const state = getAppState();
        document.getElementById('welcome-view').style.display = 'none';
        checkDailyProgress(state);
        showCurrentMessage(state);
        const playerView = document.getElementById('player-view');
        playerView.hidden = false;
        playerView.classList.add('fade-in');
      }

      function checkDailyProgress(state) {
        const today = new Date().toDateString();
        if (state.lastVisitDate !== null && state.lastVisitDate !== today) {
            if (state.maxUnlockedIndex < messages.length - 1) {
                state.maxUnlockedIndex++; 
            }
        }
        state.lastVisitDate = today;
        if (state.currentViewIndex < state.maxUnlockedIndex) {
            state.currentViewIndex = state.maxUnlockedIndex;
        }
        saveAppState(state);
      }

      function changeMessage(direction) {
        const state = getAppState();
        const newIndex = state.currentViewIndex + direction;

        if (newIndex >= 0 && newIndex <= state.maxUnlockedIndex) {
            state.currentViewIndex = newIndex;
            saveAppState(state);
            const container = document.getElementById('messageContainer');
            container.style.opacity = 0;
            setTimeout(() => {
                showCurrentMessage(state);
                container.style.opacity = 1;
            }, 200);
        }
      }

      function showCurrentMessage(state) {
        const container = document.getElementById('messageContainer');
        const msg = messages[state.currentViewIndex];
        container.innerHTML = renderCard(msg, state);
      }

      function renderCard(msg, state) {
        let audioHTML = '';
        
        // El navegador detectar√° .oga autom√°ticamente sin problemas
        const createAudioTag = (src) => `
            <div class="audio-wrapper">
                <audio controls class="custom-audio" onerror="mostrarError(this)">
                    <source src="${src}">
                </audio>
                <p class="error-msg">‚ö†Ô∏è No encuentro '${src}'</p>
            </div>
        `;

        if (Array.isArray(msg.audio)) {
            msg.audio.forEach((src, index) => {
                audioHTML += `
                <div class="audio-container">
                    <p class="audio-label">Parte ${index + 1}</p>
                    ${createAudioTag(src)}
                </div>`;
            });
        } else {
            audioHTML = `
            <div class="audio-container">
                ${createAudioTag(msg.audio)}
            </div>`;
        }

        const hasPrev = state.currentViewIndex > 0;
        const hasNext = state.currentViewIndex < state.maxUnlockedIndex;

        // Bot√≥n final para WhatsApp
        let finalActionHTML = '';
        if (msg.id === 8) {
            finalActionHTML = `
                <div class="final-action-container">
                    <p style="color: #5e3375; font-weight: 600; font-size: 1.1rem; margin-bottom: 10px;">
                        Si deseas que te siga acompa√±ando una semana m√°s, haz clic abajo:
                    </p>
                    <a href="${WHATSAPP_URL}" target="_blank" class="whatsapp-btn">
                        S√≠, quiero continuar üí¨
                    </a>
                </div>
            `;
        }

        return `
        <article class="card fade-in">
          <div class="card-title">${msg.title}</div>
          ${audioHTML}
          <div style="border-left: 3px solid #b39ddb; padding-left: 15px; margin: 20px 0;">
            <p class="verse-text">${msg.verse}</p>
          </div>
          <p class="message-text">${msg.message}</p>
          
          ${finalActionHTML}

          <div class="nav-container" style="justify-content: center;">
             <button class="nav-btn" onclick="changeMessage(-1)" ${!hasPrev ? 'disabled' : ''}>
                ${hasPrev ? '‚¨Ö Anterior' : ''}
             </button>
             
             <span style="font-size: 0.8rem; color: #aaa; align-self: center; margin: 0 10px;">
                ${state.currentViewIndex + 1} / ${state.maxUnlockedIndex + 1}
             </span>

             <button class="nav-btn" onclick="changeMessage(1)" ${!hasNext ? 'disabled' : ''}>
                ${hasNext ? 'Siguiente ‚û°' : ''}
             </button>
          </div>
        </article>
        `;
      }

      function mostrarError(audio) {
         if(audio.parentElement.querySelector('.error-msg')) {
            audio.parentElement.querySelector('.error-msg').style.display = 'block';
         }
      }
    </script>
  </body>
</html>
